var i18nData={test:"i18n信息初始化成功","balanceSheet.table.head.group":"组","balanceSheet.table.head.account":"科目","balanceSheet.table.head.item":"项目"},appCfg={ajaxTimeout:8e3,i18n:i18nData,webRoot:"http://localhost:8181",apiRoot:"http://localhost:8080/accountbook"},accApp=accApp||{};!function(e){accApp=function(e){return a(e),this};var t=accApp.prototype,a=function(e){t.cfg=e||{},t.cfg.ajaxTimeout=e.ajaxTimeout||5e3,t.cfg.i18n=e.i18n||{},t.ui={},t.data={},t.data.i18n=new net.jadedungeon.utils.i18n(t.cfg.i18n)};t.render=function(){}}(jQuery),function(e){accApp.reportTest=function(e){return a(e),this};var t=accApp.reportTest.prototype,a=function(e){t["super"]=new accApp(e),t.cfg=t["super"].cfg||{},o(e),n(e),console.log(t.data.i18n.get("test"))},o=function(a){t.ui=t["super"].ui||{},t.ui.username=e("#username"),t.ui.password=e("#password"),t.ui.submit=e("#submit"),t.ui.submit.bind("click",t.testAuth)},n=function(a){t.data=t["super"].data||{},t.data.username=e("#username").val(),t.data.password=e("#password").val()};t.render=function(e){t["super"].render(),t.loadTestData(function(a){t.loadBalanceSheet(e,a)})},t.loadBalanceSheet=function(a,o){var n='\n<tr><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.group")+'</th><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.account")+'</th><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.item")+"</th></tr>\n";if(o.length>0){n+="<tr>";for(var c=0;c<o.length;c++)n+=t.showRec(o[c],"subs")}e("#"+a).html(n)},t.countLeafNode=function(e,a,o){if(e&&e[a]&&0<e[a].length){for(var n=0;n<e[a].length;n++)o=t.countLeafNode(e[a][n],a,o);return o}return o+1},t.showRec=function(e,a){var o=t.countLeafNode(e,"subs",0),n=parseFloat(e.amount),c='<td rowspan="'+o+'">'+e.code+" - "+e.name+'</td><td rowspan="'+o+'">￥ '+jadeUtils.string.formatNumber(n,2)+"</td>";if(e&&e[a]&&0<e[a].length)for(var u=0;u<e[a].length;u++)c+=t.showRec(e[a][u],a);else c+="</tr>\n";return c},t.loadTestData=function(a){e.ajax({url:encodeURI(t.cfg.webRoot+"/data/test-report.json"),type:"GET",dataType:"json",data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(e,t,o){"success"==e.status?a(e.recs):console.error("加载测试数据失败")},error:function(e,t,a){console.error("加载测试数据失败"),console.debug(e),console.debug(t),console.debug(a)},complete:function(e,t){}})},t.testAuth=function(){var a=jadeUtils.web.webAuthBasic(t.ui.username.val(),t.ui.password.val());e.ajax({url:encodeURI(t.cfg.apiRoot+"/api/accountbook/testAuth"),type:"POST",dataType:"json",headers:{Authorization:a},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(e,t,a){"success"==e.status?console.debug(e.auth):console.error("加载测试数据失败")},error:function(e,t,a){console.error("加载测试数据失败"),console.debug(e),console.debug(t),console.debug(a)},complete:function(e,t){}})}}(jQuery),function(e){accApp.testAccount=function(e){return a(e),this};var t=accApp.testAccount.prototype,a=function(e){t["super"]=new accApp(e),t.cfg=t["super"].cfg||{},o(e),n(e),console.log(t.data.i18n.get("test"))},o=function(a){t.ui=t["super"].ui||{},t.ui.username=e("#username"),t.ui.password=e("#password"),t.ui.submit=e("#submit"),t.ui.submit.bind("click",t.testType)},n=function(a){t.data=t["super"].data||{},t.data.username=e("#username").val(),t.data.password=e("#password").val()};t.render=function(e){t["super"].render()},t.testType=function(){var a=jadeUtils.web.webAuthBasic(t.ui.username.val(),t.ui.password.val());e.ajax({url:encodeURI(t.cfg.apiRoot+"/api/accountbook/allAccountType"),type:"POST",dataType:"json",headers:{Authorization:a},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(a,o,n){if("success"==a.status){console.debug(a);var c,u={callback:{onClick:t.clickAccType}};c=e.fn.zTree.init(e("#treeDemo"),u,a.types)}else console.error("加载测试数据失败")},error:function(e,t,a){console.error("加载测试数据失败"),console.debug(e),console.debug(t),console.debug(a)},complete:function(e,t){}})},t.clickAccType=function(e,t,a){"accType"==a.type&&console.log(a.code+", "+a.name)}}(jQuery);