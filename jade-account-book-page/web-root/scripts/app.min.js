var i18nData={test:"i18n信息初始化成功","balanceSheet.table.head.group":"组","balanceSheet.table.head.account":"科目","balanceSheet.table.head.item":"项目"},appCfg={ajaxTimeout:8e3,i18n:i18nData,webRoot:"http://localhost:8181",apiRoot:"http://localhost:8080/accountbook"},accApp=accApp||{};!function(t){accApp=function(t){return this.init(t),this};var e=accApp.prototype;e.init=function(t){this.cfg=t||{},this.ui={},this.data={},this.initCfg(),this.initUI(),this.initData()},e.initCfg=function(){this.cfg.ajaxTimeout=this.cfg.ajaxTimeout||5e3,this.data.i18n=new net.jadedungeon.utils.i18n(this.cfg.i18n||{})},e.initUI=function(){},e.initData=function(){},e.render=function(){}}(jQuery),function(t){accApp.reportTest=function(t){return this.init(t),this};var e=accApp.reportTest.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initCfg(),this.initUI(),this.initData(),console.log(this.data.i18n.get("test"))},e.initCfg=function(){this.cfg.testAuthUrl=this.cfg.apiRoot+"/api/accountbook/testAuth",this.cfg.testReporthUrl=this.cfg.webRoot+"/data/test-report.json"},e.initUI=function(e){var i=this;this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.mainReport=t("#mainReport"),this.ui.submit=t("#submit"),this.ui.submit.unbind("clikd").bind("click",function(){i.testAuth()})},e.initData=function(t){var e=this;this.data=this["super"].data||{},this.data.getUsername=function(){return e.ui.username.val()},this.data.getPassword=function(){return e.ui.password.val()},this.data.setUsername=function(t){e.ui.username.val(t)},this.data.setPassword=function(t){e.ui.password.val(t)}},e.render=function(){var t=this;this["super"].render(),this.loadTestData(function(e){t.loadBalanceSheet(t.ui.mainReport,e)})},e.loadBalanceSheet=function(t,e){var i='\n<tr><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.group")+'</th><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.account")+'</th><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.item")+"</th></tr>\n";if(e.length>0){i+="<tr>";for(var a=0;a<e.length;a++)i+=this.showRec(e[a],"subs")}t.html(i)},e.countLeafNode=function(t,e,i){if(t&&t[e]&&0<t[e].length){for(var a=0;a<t[e].length;a++)i=this.countLeafNode(t[e][a],e,i);return i}return i+1},e.showRec=function(t,e){var i=this.countLeafNode(t,"subs",0),a=parseFloat(t.amount),n='<td rowspan="'+i+'">'+t.code+" - "+t.name+'</td><td rowspan="'+i+'">￥ '+jadeUtils.string.formatNumber(a,2)+"</td>";if(t&&t[e]&&0<t[e].length)for(var s=0;s<t[e].length;s++)n+=this.showRec(t[e][s],e);else n+="</tr>\n";return n},e.loadTestData=function(e){var i=this;t.ajax({url:encodeURI(i.cfg.testReporthUrl),type:"GET",dataType:"json",data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,i,a){"success"==t.status?e(t.recs):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})},e.testAuth=function(){var e=this,i=jadeUtils.web.webAuthBasic(e.data.getUsername(),e.data.getPassword());t.ajax({url:encodeURI(e.cfg.testAuthUrl),type:"POST",dataType:"json",headers:{Authorization:i},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,e,i){"success"==t.status?console.debug(t.auth):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})}}(jQuery),function(t){accApp.testAccount=function(t){return this.init(t),this};var e=accApp.testAccount.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initCfg(),this.initUI(),this.initData(),console.log(this.data.i18n.get("test"))},e.initCfg=function(){var t=this;this.cfg.accTypeUrl=this.cfg.apiRoot+"/api/accountbook/allAccountType",this.cfg.accTypeTreeSetting={callback:{onClick:function(e,i,a){t.clickAccType(e,i,a)}}}},e.initUI=function(){var e=this;this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.submit=t("#submit"),this.ui.submit.unbind("clikd").bind("click",function(){e.loadAccTypeTree()}),this.ui.accTypeTree=t("#accTypeTree"),this.ui.accTypeTreeObj={},this.ui.testRecTpl=t.templates("#testRecTpl"),this.ui.testRec=t("#testRec"),this.ui.testRec2Tpl=t.templates("#testRec2Tpl")},e.initData=function(){var t=this;this.data.getUsername=function(){return t.ui.username.val()},this.data.getPassword=function(){return t.ui.password.val()},this.data.setUsername=function(e){t.ui.username.val(e)},this.data.setPassword=function(e){t.ui.password.val(e)},this.data.testRec=[{name:"Robert",nickname:"Bob",showNickname:!0},{name:"Susan",nickname:"Sue",showNickname:!1}],this.data.testRec2=[{name:"Robert",nickname:"Bob",showNickname:!0},{name:"Susan",nickname:"Sue",showNickname:!1}]},e.render=function(){this["super"].render(),this.renderRec()},e.renderRec=function(){this.ui.testRec.html(this.ui.testRecTpl.render(this.data.testRec)),this.ui.testRec2Tpl.link("#testRec2",this.data.testRec2)},e.loadAccTypeTree=function(){var e=this,i=jadeUtils.web.webAuthBasic(e.data.getUsername(),e.data.getPassword());t.ajax({url:encodeURI(e.cfg.accTypeUrl),type:"POST",dataType:"json",headers:{Authorization:i},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(i,a,n){"success"==i.status?(console.debug(i),e.ui.accTypeTreeObj=t.fn.zTree.init(e.ui.accTypeTree,e.cfg.accTypeTreeSetting,i.types)):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})},e.clickAccType=function(t,e,i){"accType"==i.type&&console.log(i.code+", "+i.name)}}(jQuery);