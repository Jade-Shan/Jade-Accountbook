var i18n=new net.jadedungeon.utils.i18n({"navbar.appname":"小玉记账本","navbar.usernameprefix":"当前用户：","navbar.login":"请登录","balanceSheet.table.head.group":"组","balanceSheet.table.head.account":"科目","balanceSheet.table.head.item":"项目",test:"i18n信息初始化成功"}),accApp=accApp||{};!function(t){accApp=function(t){return this.init(t),this};var e=accApp.prototype;e.init=function(t){this.cfg=t||{},this.ui={},this.data={},this.initCfg(),this.initUI(),this.initData(),this.barinit()},e.initCfg=function(){this.cfg.ajaxTimeout=this.cfg.ajaxTimeout||5e3,this.cfg.testAuthUrl=this.cfg.apiRoot+"/api/accountbook/testAuth"},e.initUI=function(){},e.initData=function(){},e.render=function(){},e.checkLogin=function(e,i,n,a,s){var o=this;if(""!==e&&""!==i){var c=jadeUtils.web.webAuthBasic(e,i);t.ajax({type:"POST",dataType:"json",timeout:o.cfg.ajaxTimeout,url:encodeURI(o.cfg.testAuthUrl),headers:{Authorization:c},data:{},success:function(t,e,i){console.debug(e),"success"==t.status&&"success"==t.auth?n(t):a(t)},error:function(t,e,i){s(i)},complete:function(t,e){}})}else console.debug("no username or password")},e.login=function(t,e){var i=this;i.checkLogin(t,e,function(n){jadeUtils.web.cookieOperator("username",t),jadeUtils.web.cookieOperator("password",e),i.ui.divUserLogin.removeClass("has-error"),i.ui.divUserLogin.hide(),i.ui.lbUsername.html(t),i.ui.userinfo.show(),i.ui.accOverview.show()},function(t){console.debug(t.reason),i.ui.divUserLogin.addClass("has-error")},function(t){alert("Ajax Error")})},e.barinit=function(){var e=this;e.ui.topnav=t("#topnav"),e.ui.topnavTpl=t.templates("#topnavTpl"),e.ui.topnav.html(e.ui.topnavTpl.render(e.cfg.topnavCfg)),e.ui.username=t("#username"),e.ui.password=t("#password"),e.ui.userinfo=t("#div-userinfo"),e.ui.lbUsername=t("#lb-username"),e.ui.accOverview=t("#mu-accOverview"),e.ui.divUserLogin=t("#div-userlogin"),e.ui.btnLogin=t("#btn-login"),e.ui.btnLogin.unbind("click").bind("click",function(t){e.login(e.data.getUsername(),e.data.getPassword())}),e.ui.btnLogout=t("#btn-logout"),e.ui.btnLogout.unbind("click").bind("click",function(t){e.ui.accOverview.hide(),e.ui.userinfo.hide(),e.ui.divUserLogin.show()}),e.data.getUsername=function(){return e.ui.username.val()},e.data.getPassword=function(){return e.ui.password.val()},e.data.setUsername=function(t){e.ui.username.val(t)},e.data.setPassword=function(t){e.ui.password.val(t)},e.ui.userinfo.hide(),e.ui.accOverview.hide(),e.data.setUsername(jadeUtils.web.cookieOperator("username")),e.data.setPassword(jadeUtils.web.cookieOperator("password")),e.login(e.data.getUsername(),e.data.getPassword())}}(jQuery),function(t){accApp.reportTest=function(t){return this.init(t),this};var e=accApp.reportTest.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initCfg(),this.initUI(),this.initData(),console.log(i18n.get("test"))},e.initCfg=function(){this.cfg.testReporthUrl=this.cfg.webRoot+"/data/test-report.json"},e.initUI=function(e){var i=this;this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.mainReport=t("#mainReport"),this.ui.submit=t("#submit"),this.ui.submit.unbind("clikd").bind("click",function(){i.testAuth()})},e.initData=function(t){},e.render=function(){var t=this;this["super"].render(),this.loadTestData(function(e){t.loadBalanceSheet(t.ui.mainReport,e)})},e.loadBalanceSheet=function(t,e){var i='\n<tr><th colspan="2">'+i18n.get("balanceSheet.table.head.group")+'</th><th colspan="2">'+i18n.get("balanceSheet.table.head.account")+'</th><th colspan="2">'+i18n.get("balanceSheet.table.head.item")+"</th></tr>\n";if(e.length>0){i+="<tr>";for(var n=0;n<e.length;n++)i+=this.showRec(e[n],"subs")}t.html(i)},e.countLeafNode=function(t,e,i){if(t&&t[e]&&0<t[e].length){for(var n=0;n<t[e].length;n++)i=this.countLeafNode(t[e][n],e,i);return i}return i+1},e.showRec=function(t,e){var i=this.countLeafNode(t,"subs",0),n=parseFloat(t.amount),a='<td rowspan="'+i+'">'+t.code+" - "+t.name+'</td><td rowspan="'+i+'">￥ '+jadeUtils.string.formatNumber(n,2)+"</td>";if(t&&t[e]&&0<t[e].length)for(var s=0;s<t[e].length;s++)a+=this.showRec(t[e][s],e);else a+="</tr>\n";return a},e.loadTestData=function(e){var i=this;t.ajax({url:encodeURI(i.cfg.testReporthUrl),type:"GET",dataType:"json",data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,i,n){"success"==t.status?e(t.recs):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})},e.testAuth=function(){var e=this,i=jadeUtils.web.webAuthBasic(e.data.getUsername(),e.data.getPassword());t.ajax({url:encodeURI(e.cfg.testAuthUrl),type:"POST",dataType:"json",headers:{Authorization:i},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,e,i){"success"==t.status?console.debug(t.auth):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})}}(jQuery),function(t){accApp.testAccount=function(t){return this.init(t),this};var e=accApp.testAccount.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initCfg(),this.initUI(),this.initData(),console.log(i18n.get("test"))},e.initCfg=function(){var t=this;this.cfg.accTypeUrl=this.cfg.apiRoot+"/api/accountbook/allAccountType",this.cfg.accTypeTreeSetting={callback:{onClick:function(e,i,n){t.clickAccType(e,i,n)}}}},e.initUI=function(){var e=this;this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.submit=t("#submit"),this.ui.submit.unbind("click").bind("click",function(){e.loadAccTypeTree()}),this.ui.accTypeTree=t("#accTypeTree"),this.ui.accTypeTreeObj={},this.ui.testRecTpl=t.templates("#testRecTpl"),this.ui.testRec=t("#testRec"),this.ui.testRec2Tpl=t.templates("#testRec2Tpl")},e.initData=function(){var t=this;this.data.getUsername=function(){return t.ui.username.val()},this.data.getPassword=function(){return t.ui.password.val()},this.data.setUsername=function(e){t.ui.username.val(e)},this.data.setPassword=function(e){t.ui.password.val(e)},this.data.testRec=[{name:"Robert",nickname:"Bob",showNickname:!0},{name:"Susan",nickname:"Sue",showNickname:!1}],this.data.testRec2=[{name:"Robert",nickname:"Bob",showNickname:!0},{name:"Susan",nickname:"Sue",showNickname:!1}]},e.render=function(){this["super"].render(),this.renderRec()},e.renderRec=function(){this.ui.testRec.html(this.ui.testRecTpl.render(this.data.testRec)),this.ui.testRec2Tpl.link("#testRec2",this.data.testRec2)},e.loadAccTypeTree=function(){var e=this,i=jadeUtils.web.webAuthBasic(e.data.getUsername(),e.data.getPassword());t.ajax({url:encodeURI(e.cfg.accTypeUrl),type:"POST",dataType:"json",headers:{Authorization:i},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(i,n,a){"success"==i.status?(console.debug(i),e.ui.accTypeTreeObj=t.fn.zTree.init(e.ui.accTypeTree,e.cfg.accTypeTreeSetting,i.types)):console.error("加载测试数据失败")},error:function(t,e,i){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(i)},complete:function(t,e){}})},e.clickAccType=function(t,e,i){"accType"==i.type&&console.log(i.code+", "+i.name)}}(jQuery);