var i18nData={test:"i18n信息初始化成功","balanceSheet.table.head.group":"组","balanceSheet.table.head.account":"科目","balanceSheet.table.head.item":"项目"},appCfg={ajaxTimeout:8e3,i18n:i18nData,webRoot:"http://localhost:8181",apiRoot:"http://localhost:8080/accountbook"},accApp=accApp||{};!function(t){accApp=function(t){return this.init(t),this};var e=accApp.prototype;e.init=function(t){this.cfg=t||{},this.ui={},this.data={},this.cfg.ajaxTimeout=t.ajaxTimeout||5e3,this.data.i18n=new net.jadedungeon.utils.i18n(t.i18n||{})},e.initUI=function(){},e.initData=function(){},e.render=function(){}}(jQuery),function(t){accApp.reportTest=function(t){return this.init(t),this};var e=accApp.reportTest.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initUI(t),this.initData(t),console.log(this.data.i18n.get("test"))},e.initUI=function(e){this["super"].initUI(),this.ui=this["super"].ui||{},this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.submit=t("#submit"),this.ui.submit.bind("click",this.testAuth)},e.initData=function(e){this["super"].initData(),this.data=this["super"].data||{},this.data.username=t("#username").val(),this.data.password=t("#password").val()},e.render=function(t){this["super"].render(),this.loadTestData(function(e){this.loadBalanceSheet(t,e)})},e.loadBalanceSheet=function(e,a){var i='\n<tr><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.group")+'</th><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.account")+'</th><th colspan="2">'+this.data.i18n.get("balanceSheet.table.head.item")+"</th></tr>\n";if(a.length>0){i+="<tr>";for(var s=0;s<a.length;s++)i+=this.showRec(a[s],"subs")}t("#"+e).html(i)},e.countLeafNode=function(t,e,a){if(t&&t[e]&&0<t[e].length){for(var i=0;i<t[e].length;i++)a=this.countLeafNode(t[e][i],e,a);return a}return a+1},e.showRec=function(t,e){var a=this.countLeafNode(t,"subs",0),i=parseFloat(t.amount),s='<td rowspan="'+a+'">'+t.code+" - "+t.name+'</td><td rowspan="'+a+'">￥ '+jadeUtils.string.formatNumber(i,2)+"</td>";if(t&&t[e]&&0<t[e].length)for(var n=0;n<t[e].length;n++)s+=this.showRec(t[e][n],e);else s+="</tr>\n";return s},e.loadTestData=function(e){t.ajax({url:encodeURI(this.cfg.webRoot+"/data/test-report.json"),type:"GET",dataType:"json",data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,a,i){"success"==t.status?e(t.recs):console.error("加载测试数据失败")},error:function(t,e,a){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(a)},complete:function(t,e){}})},e.testAuth=function(){var e=jadeUtils.web.webAuthBasic(this.ui.username.val(),this.ui.password.val());t.ajax({url:encodeURI(this.cfg.apiRoot+"/api/accountbook/testAuth"),type:"POST",dataType:"json",headers:{Authorization:e},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(t,e,a){"success"==t.status?console.debug(t.auth):console.error("加载测试数据失败")},error:function(t,e,a){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(a)},complete:function(t,e){}})}}(jQuery),function(t){accApp.testAccount=function(t){return this.init(t),this};var e=accApp.testAccount.prototype;e["super"]=accApp.prototype,e.init=function(t){this["super"]=new accApp(t),this.cfg=this["super"].cfg||{},this.ui=this["super"].ui||{},this.data=this["super"].data||{},this.initUI(t),this.initData(t),console.log(this.data.i18n.get("test"))},e.initUI=function(){var e=this;this["super"].initUI(),this.ui=this["super"].ui||{},this.ui.username=t("#username"),this.ui.password=t("#password"),this.ui.submit=t("#submit"),this.ui.submit.unbind("clikd").bind("click",function(){e.testType()})},e.initData=function(){var t=this;this["super"].initData(),this.data=this["super"].data||{},this.data.getUsername=function(){return console.log(t.ui.username.val()),t.ui.username.val()},this.data.getPassword=function(){return console.log(t.ui.password.val()),t.ui.password.val()},this.data.setUsername=function(t){this.ui.username.val(t)},this.data.setPassword=function(t){this.ui.password.val(t)}},e.render=function(){this["super"].render()},e.testType=function(){var e=this;console.log(e.data.getUsername()),console.log(e.data.getPassword());var a=jadeUtils.web.webAuthBasic(e.data.getUsername(),e.data.getPassword());t.ajax({url:encodeURI(this.cfg.apiRoot+"/api/accountbook/allAccountType"),type:"POST",dataType:"json",headers:{Authorization:a},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(e,a,i){if("success"==e.status){console.debug(e);var s,n={callback:{onClick:this.clickAccType}};s=t.fn.zTree.init(t("#treeDemo"),n,e.types)}else console.error("加载测试数据失败")},error:function(t,e,a){console.error("加载测试数据失败"),console.debug(t),console.debug(e),console.debug(a)},complete:function(t,e){}})},e.clickAccType=function(t,e,a){"accType"==a.type&&console.log(a.code+", "+a.name)}}(jQuery);