var i18nData={test:"i18n信息初始化成功","balanceSheet.table.head.group":"组","balanceSheet.table.head.account":"科目","balanceSheet.table.head.item":"项目"},appCfg={ajaxTimeout:8e3,i18n:i18nData,webRoot:"http://localhost:8181",apiRoot:"http://localhost:8080/accountbook"},accApp=accApp||{};!function(e){accApp=function(e){return a(e),this};var t=accApp.prototype,a=function(e){t.cfg=e||{},t.cfg.ajaxTimeout=e.ajaxTimeout||5e3,t.cfg.i18n=e.i18n||{},t.ui={},t.data={},t.data.i18n=new net.jadedungeon.utils.i18n(t.cfg.i18n)};t.render=function(){}}(jQuery),function(e){accApp.reportTest=function(e){return a(e),this};var t=accApp.reportTest.prototype,a=function(e){t["super"]=new accApp(e),t.cfg=t["super"].cfg||{},n(e),o(e),console.log(t.data.i18n.get("test"))},n=function(a){t.ui=t["super"].ui||{},t.ui.username=e("#username"),t.ui.password=e("#password"),t.ui.submit=e("#submit"),t.ui.submit.bind("click",t.testAuth)},o=function(a){t.data=t["super"].data||{},t.data.username=e("#username").val(),t.data.password=e("#password").val()};t.render=function(e){t["super"].render(),t.loadTestData(function(a){t.loadBalanceSheet(e,a)})},t.loadBalanceSheet=function(a,n){var o='\n<tr><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.group")+'</th><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.account")+'</th><th colspan="2">'+t.data.i18n.get("balanceSheet.table.head.item")+"</th></tr>\n";if(n.length>0){o+="<tr>";for(var c=0;c<n.length;c++)o+=t.showRec(n[c],"subs")}e("#"+a).html(o)},t.countLeafNode=function(e,a,n){if(e&&e[a]&&0<e[a].length){for(var o=0;o<e[a].length;o++)n=t.countLeafNode(e[a][o],a,n);return n}return n+1},t.showRec=function(e,a){var n=t.countLeafNode(e,"subs",0),o=parseFloat(e.amount),c='<td rowspan="'+n+'">'+e.code+" - "+e.name+'</td><td rowspan="'+n+'">￥ '+jadeUtils.string.formatNumber(o,2)+"</td>";if(e&&e[a]&&0<e[a].length)for(var u=0;u<e[a].length;u++)c+=t.showRec(e[a][u],a);else c+="</tr>\n";return c},t.loadTestData=function(a){e.ajax({url:encodeURI(t.cfg.webRoot+"/data/test-report.json"),type:"GET",dataType:"json",data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(e,t,n){"success"==e.status?a(e.recs):console.error("加载测试数据失败")},error:function(e,t,a){console.error("加载测试数据失败"),console.debug(e),console.debug(t),console.debug(a)},complete:function(e,t){}})},t.testAuth=function(){var a=jadeUtils.web.webAuthBasic(t.ui.username.val(),t.ui.password.val());e.ajax({url:encodeURI(t.cfg.apiRoot+"/api/accountbook/testAuth"),type:"POST",dataType:"json",headers:{Authorization:a},data:{},timeout:net.jadedungeon.ajaxTimeout,success:function(e,t,a){"success"==e.status?console.debug(e.auth):console.error("加载测试数据失败")},error:function(e,t,a){console.error("加载测试数据失败"),console.debug(e),console.debug(t),console.debug(a)},complete:function(e,t){}})}}(jQuery);